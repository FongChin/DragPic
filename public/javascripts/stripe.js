// Generated by CoffeeScript 1.3.3
(function() {
  var stripeResponseHandler, validateNumber;

  Stripe.setPublishableKey('pk_wEshmX7mEF5LDcUyjE4NwoKtr0UCd');

  validateNumber = function(event) {
    var key;
    if (window.event) {
      key = event.keyCode;
    } else {
      key = event.which;
    }
    if (event.keyCode === 8 || event.keyCode === 46 || event.keyCode === 37 || event.keyCode === 39) {
      return true;
    } else if (key < 48 || key > 57) {
      return false;
    } else {
      return true;
    }
  };

  $('.integer').keypress(validateNumber);

  $("#payment-form").submit(function(event) {
    var ee;
    $('.submit-button').attr("disabled", "disabled");
    ee = $('#em').val();
    Stripe.createToken({
      number: $('.card-number').val(),
      cvc: $('.card-cvc').val(),
      exp_month: $('.card-expiry-month').val(),
      exp_year: $('.card-expiry-year').val(),
      email: $('#em').val()
    }, stripeResponseHandler);
    return false;
  });

  stripeResponseHandler = function(status, response) {
    var form$, token;
    if (response.error) {
      $(".payment-errors").text(response.error.message);
      return $(".submit-button").removeAttr("disabled");
    } else {
      form$ = $('#payment-form');
      token = response['id'];
      console.log(status);
      form$.append("<input type='hidden' name='stripeToken' value='" + token + "'/>");
      return form$.get(0).submit();
    }
  };

}).call(this);
